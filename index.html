<script>
const OCCUPIED = 0
const WHITE = 1
const BLACK = 2
const MAN = 4
const KING = 8
const FREE = 16
const CHANGECOLOR = 3
const MAXMOVES = 50;

// 5s go from right to left
// 6s go from left to right

// actual
// +4 Capture Up and Left
// +5 Capture Up and Right
// -4 Capture Down and Right
// -5 Capture Down and Left 


// in my view
// -5 Capture Down and Left 

var b = new Array(46);
var board = [ // white on the right, black on the left
  /*[6, 0, 6, 0, 0, 0, 5, 0],
  [0, 6, 0, 0, 0, 5, 0, 5],
  [6, 0, 6, 0, 0, 0, 5, 0],
  [0, 6, 0, 0, 0, 5, 0, 5],
  [6, 0, 6, 0, 0, 0, 5, 0],
  [0, 6, 0, 0, 0, 5, 0, 5],
  [6, 0, 6, 0, 0, 0, 5, 0],
  [0, 6, 0, 0, 0, 5, 0, 5]*/

  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 6, 0, 6, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 6, 0, 6, 0, 0, 0, 0],
  [5, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0]
];

const m2coord = [
  'xx',
  'b8', 'd8', 'f8', 'h8',
  'a7', 'c7', 'e7', 'g7',
  'b6', 'd6', 'f6', 'h6',
  'a5', 'c5', 'e5', 'g5',
  'b4', 'd4', 'f4', 'h4',
  'a3', 'c3', 'e3', 'g3',
  'b2', 'd2', 'f2', 'h2',
  'a1', 'c1', 'e1', 'g1'
];

const coord2sq = {
  'h8':  5, 'f8':  6, 'd8':  7, 'b8': 8,
  'g7': 10, 'e7': 11, 'c7': 12, 'a7': 13,
  'h6': 14, 'f6': 15, 'd6': 16, 'b6': 17,
  'g5': 19, 'e5': 20, 'c5': 21, 'a5': 22,
  'h4': 23, 'f4': 24, 'd4': 25, 'b4': 26,
  'g3': 28, 'e3': 29, 'c3': 30, 'a3': 31,
  'h2': 32, 'f2': 33, 'd2': 34, 'b2': 35,
  'g1': 37, 'e1': 38, 'c1': 39, 'a1': 40
}

const sq2coord = {
   5: 'h8',  6: 'f8',  7: 'd8',  8: 'b8',
  10: 'g7', 11: 'e7', 12: 'c7', 13: 'a7',
  14: 'h6', 15: 'f6', 16: 'd6', 17: 'b6',
  19: 'g5', 20: 'e5', 21: 'c5', 22: 'a5',
  23: 'h4', 24: 'f4', 25: 'd4', 26: 'b4',
  28: 'g3', 29: 'e3', 30: 'c3', 31: 'a3',
  32: 'h2', 33: 'f2', 34: 'd2', 35: 'b2',
  37: 'g1', 38: 'e1', 39: 'c1', 40: 'a1'
}

var ply = 0;

function printBoard() {
  brd2dsp();
  let boardStr = '';
  let pieces = { 5: 'o', 6: 'x', 9: 'O', 10: 'X', 16: '.'};
  for (let row = 0; row < 8; row++) {
    for (let col = 0; col < 8; col++) {
      if (col == 0) boardStr += (8-row)
      boardStr += ' ' + pieces[board[7-col][row]];
    } boardStr += '\n';
  } boardStr += '  a b c d e f g h';
  console.log(boardStr);
}

function clearDisplay() {
  for (let row = 0; row < 8; row++)
    for (let col = 0; col < 8; col++)
      board[row][col] = FREE;
}

function move2str(move) {
  let j;
  let src = move.m[0] % 256;
  let dst = move.m[1] % 256;
  src = src-parseInt(src/9);
  dst = dst-parseInt(dst/9);
  src -= 5; dst -= 5;
  j = src%4; src -= j; j = 3-j; src += j;
  j = dst%4; dst -= j; j = 3-j; dst += j;
  src++; dst++;
  let c = '-';
  if(move.l > 2) c = 'x';
  return m2coord[src]+c+m2coord[dst];
}

function dsp2brd() {
  for(let sq = 0; sq < 46; sq++) b[sq] = OCCUPIED;
  for(let sq = 5; sq <= 40; sq++) b[sq] = FREE;
  b[ 5]=board[0][0];b[ 6]=board[2][0];b[ 7]=board[4][0];b[ 8]=board[6][0];
  b[10]=board[1][1];b[11]=board[3][1];b[12]=board[5][1];b[13]=board[7][1];
  b[14]=board[0][2];b[15]=board[2][2];b[16]=board[4][2];b[17]=board[6][2];
  b[19]=board[1][3];b[20]=board[3][3];b[21]=board[5][3];b[22]=board[7][3];
  b[23]=board[0][4];b[24]=board[2][4];b[25]=board[4][4];b[26]=board[6][4];
  b[28]=board[1][5];b[29]=board[3][5];b[30]=board[5][5];b[31]=board[7][5];
  b[32]=board[0][6];b[33]=board[2][6];b[34]=board[4][6];b[35]=board[6][6];
  b[37]=board[1][7];b[38]=board[3][7];b[39]=board[5][7];b[40]=board[7][7];
  for(let sq = 5; sq <= 40; sq++) if (b[sq] == 0) b[sq] = FREE;
  for(let sq = 9; sq <= 36; sq += 9) b[sq] = OCCUPIED;
}

function brd2dsp() {
  clearDisplay();
  board[0][0]=b[5];board[2][0]=b[6];board[4][0]=b[7];board[6][0]=b[8];
  board[1][1]=b[10];board[3][1]=b[11];board[5][1]=b[12];board[7][1]=b[13];
  board[0][2]=b[14];board[2][2]=b[15];board[4][2]=b[16];board[6][2]=b[17];
  board[1][3]=b[19];board[3][3]=b[20];board[5][3]=b[21];board[7][3]=b[22];
  board[0][4]=b[23];board[2][4]=b[24];board[4][4]=b[25];board[6][4]=b[26];
  board[1][5]=b[28];board[3][5]=b[29];board[5][5]=b[30];board[7][5]=b[31];
  board[0][6]=b[32];board[2][6]=b[33];board[4][6]=b[34];board[6][6]=b[35];
  board[1][7]=b[37];board[3][7]=b[38];board[5][7]=b[39];board[7][7]=b[40];
}

function createMove() {
  return {l: 0, m: new Array(10).fill(0), path: new Array(10).fill(0)};
}

function createMoveList() {
  let moveList = [];
  for (let i = 0; i < MAXMOVES; i++) moveList.push(createMove());
  return moveList;
}

function printMoveList(moveList, n) {
  for (let i = 0; i < n; i++) console.log(move2str(moveList[i]));
}

function generateQuiets(moveList, color) {
  let m = 0, temp = 0, n = 0;
  if (color == BLACK) {
    for (let sq = 5; sq <= 40; sq++) {
      if ((b[sq] & BLACK) != 0) {
        if ((b[sq] & MAN) != 0) {
          if ((b[sq+4] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            if (sq >= 32) m = (BLACK|KING); else m = (BLACK|MAN);
            m = m << 8;  m += (sq+4); moveList[n].m[1] = m;
            m = (BLACK|MAN); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++;
          }
          if ((b[sq+5] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            if (sq >= 32) m = (BLACK|KING); else m = (BLACK|MAN);
            m = m << 8;  m += (sq+5); moveList[n].m[1] = m;
            m = (BLACK|MAN); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++;
          }
        }
        if ((b[sq] & KING) != 0) {
          temp = sq; temp += 4;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (BLACK|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (BLACK|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp += 4;
          }
          temp = sq; temp += 5;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (BLACK|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (BLACK|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp += 5;
          }
          temp = sq; temp -= 4;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (BLACK|KING); m = m << 8; m += temp; moveList.m[1] = m;
            m = (BLACK|KING); m = m << 8; m += sq; moveList.m[0] = m;
            n++; temp -= 4;
          }
          temp = sq; temp -= 5;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (BLACK|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (BLACK|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp -= 5;
          }
        }
      }
    }
  }
  if (color == WHITE) {
    for (let sq = 5; sq <= 40; sq++) {
      if ((b[sq] & WHITE) != 0) {
        if ((b[sq] & MAN) != 0) {
          if ((b[sq-4] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            if (sq <= 13) m = (WHITE|KING); else m = (WHITE|MAN);
            m = m << 8;  m += (sq-4); moveList[n].m[1] = m;
            m = (WHITE|MAN); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++;
          }
          if ((b[sq-5] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            if (sq <= 13) m = (WHITE|KING); else m = (WHITE|MAN);
            m = m << 8;  m += (sq-5); moveList[n].m[1] = m;
            m = (WHITE|MAN); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++;
          }
        }
        if ((b[sq] & KING) != 0) {
          temp = sq; temp += 4;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (WHITE|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (WHITE|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp += 4;
          }
          temp = sq; temp += 5;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (WHITE|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (WHITE|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp += 5;
          }
          temp = sq; temp -= 4;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (WHITE|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (WHITE|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp -= 4;
          }
          temp = sq; temp -= 5;
          while((b[temp] & FREE) != 0) {
            let move = createMove(); move.l = 2;
            m = (WHITE|KING); m = m << 8; m += temp; moveList[n].m[1] = m;
            m = (WHITE|KING); m = m << 8; m += sq; moveList[n].m[0] = m;
            n++; temp -= 5;
          }
        }
      }
    }
  } return n;
}

function generateCaptures(moveList, color) {
  let n = [0];
  let sq, tmp, temp, capSq, foundPd;
  if (color == BLACK) {
    for (sq = 5; sq <= 40; sq++) {
      if ((b[sq] & BLACK) != 0) {
        if ((b[sq] & MAN) != 0) {
          b[sq] = FREE;
          
          // +4
          if ((b[sq+4] & WHITE) != 0) {
            if (b[sq+8] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq+8);
              m = (BLACK|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq+4]; m = m << 8; m += (sq+4); moveList[n[0]].m[2] = m;
              if (sq >= 28) {
                m = (BLACK|KING); m = m << 8; m += (sq+8); moveList[n[0]].m[1] = m;
                tmp = b[sq+4]; b[sq+4] = OCCUPIED;
                blackKingCapture(n, moveList, sq+8);
                b[sq+4] = tmp;
              } else {
                m = (BLACK|MAN); m = m << 8; m += (sq+8); moveList[n[0]].m[1] = m;
                tmp = b[sq+4]; b[sq+4] = OCCUPIED;
                blackManCapture(n, moveList, sq+8);
                b[sq+4] = tmp;
              }
            }
          }
          
          // +5
          if ((b[sq+5] & WHITE) != 0) {
            if (b[sq+10] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq+10);
              m = (BLACK|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq+5]; m = m << 8; m += (sq+5); moveList[n[0]].m[2] = m;
              if (sq >= 28) {
                m = (BLACK|KING); m = m << 8; m += (sq+10); moveList[n[0]].m[1] = m;
                tmp = b[sq+5]; b[sq+5] = OCCUPIED;
                blackKingCapture(n, moveList, sq+10);
                b[sq+5] = tmp;
              } else {
                m = (BLACK|MAN); m = m << 8; m += (sq+10); moveList[n[0]].m[1] = m;
                tmp = b[sq+5]; b[sq+5] = OCCUPIED;
                blackManCapture(n, moveList, sq+10);
                b[sq+5] = tmp;
              }
            }
          }
          
          // -4
          if ((b[sq-4] & WHITE) != 0) {
            if (b[sq-8] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq-8);
              m = (BLACK|MAN); m = m << 8; m += (sq-8); moveList[n[0]].m[1] = m;
              m = (BLACK|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq-4]; m = m << 8; m += (sq-4); moveList[n[0]].m[2] = m;
              tmp = b[sq-4]; b[sq-4] = OCCUPIED;
              blackManCapture(n, moveList, sq-8);
              b[sq-4] = tmp;
            }
          }
          
          // -5
          if ((b[sq-5] & WHITE) != 0) {
            if (b[sq-10] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq-10);
              m = (BLACK|MAN); m = m << 8; m += (sq-10); moveList[n[0]].m[1] = m;
              m = (BLACK|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq-5]; m = m << 8; m += (sq-5); moveList[n[0]].m[2] = m;
              tmp = b[sq-5]; b[sq-5] = OCCUPIED;
              blackManCapture(n, moveList, sq-10);
              b[sq-5] = tmp;
            }
          }
          
          b[sq] = (BLACK|MAN);
        }
    
        if ((b[sq] & KING) != 0) {
          b[sq] = FREE;
          
          // +4
          temp = sq;
          foundPd = 0;
          do temp += 4
          while((b[temp] & FREE) != 0);
          if ((b[temp] & WHITE) != 0) {
            capSq = temp;
            temp += 4;
            while((b[temp] & FREE) != 0) {
              if (testFrom13b(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp += 4;
            }
            if (!foundPd) {
              temp = capSq;
              temp += 4;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp += 4;
              }
            }
          }
          
          // +5
          temp = sq;
          foundPd = 0;
          do temp += 5
          while((b[temp] & FREE) != 0);
          if ((b[temp] & WHITE) != 0) {
            capSq = temp;
            temp += 5;
            while((b[temp] & FREE) != 0) {
              if (testFrom02b(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp += 5;
            }
            if (!foundPd) {
              temp = capSq;
              temp += 5;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp += 5;
              }
            }
          }
          
          // -4
          temp = sq;
          foundPd = 0;
          do temp -= 4
          while((b[temp] & FREE) != 0);
          if ((b[temp] & WHITE) != 0) {
            capSq = temp;
            temp -= 4;
            while((b[temp] & FREE) != 0) {
              if (testFrom13b(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp -= 4;
            }
            if (!foundPd) {
              temp = capSq;
              temp -= 4;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp -= 4;
              }
            }
          }
          
          // -5
          temp = sq;
          foundPd = 0;
          do temp -= 5
          while((b[temp] & FREE) != 0);
          if ((b[temp] & WHITE) != 0) {
            capSq = temp;
            temp -= 5;
            while((b[temp] & FREE) != 0) {
              if (testFrom02b(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp -= 5;
            }
            if (!foundPd) {
              temp = capSq;
              temp -= 5;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (BLACK|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (BLACK|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp -= 5;
              }
            }
          }
          
          b[sq] = (BLACK|KING);
        }
      }
    }
  }

  if (color == WHITE) {
    for (sq = 5; sq <= 40; sq++) {
      if ((b[sq] & WHITE) != 0) {
        if ((b[sq] & MAN) != 0) {
          b[sq] = FREE;
          
          // +4
          if ((b[sq+4] & BLACK) != 0) {
            if (b[sq+8] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq+8);
              m = (WHITE|MAN); m = m << 8; m += (sq+8); moveList[n[0]].m[1] = m;
              m = (WHITE|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq+4]; m = m << 8; m += (sq+4); moveList[n[0]].m[2] = m;
              tmp = b[sq+4]; b[sq+4] = OCCUPIED;
              whiteManCapture(n, moveList, sq+8);
              b[sq+4] = tmp;
            }
          }
          
          // +5
          if ((b[sq+5] & BLACK) != 0) {console.log('back')
            if (b[sq+10] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq+10);
              m = (WHITE|MAN); m = m << 8; m += (sq+10); moveList[n[0]].m[1] = m;
              m = (WHITE|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq+5]; m = m << 8; m += (sq+5); moveList[n[0]].m[2] = m;
              tmp = b[sq+5]; b[sq+5] = OCCUPIED;
              whiteManCapture(n, moveList, sq+10);
              b[sq+5] = tmp;
            }
          }
          
          // -4
          if ((b[sq-4] & BLACK) != 0) {
            if (b[sq-8] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq-8);
              m = (WHITE|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq-4]; m = m << 8; m += (sq-4); moveList[n[0]].m[2] = m;
              if (sq <= 17) {
                m = (WHITE|KING); m = m << 8; m += (sq-8); moveList[n[0]].m[1] = m;
                tmp = b[sq-4]; b[sq-4] = OCCUPIED;
                whiteKingCapture(n, moveList, sq-8);
                b[sq-4] = tmp;
              } else {
                m = (WHITE|MAN); m = m << 8; m += (sq-8); moveList[n[0]].m[1] = m;
                tmp = b[sq-4]; b[sq-4] = OCCUPIED;
                whiteManCapture(n, moveList, sq-8);
                b[sq-4] = tmp;
              }
            }
          }
          
          // -5
          if ((b[sq-5] & BLACK) != 0) {
            if (b[sq-10] & FREE ) {
              moveList[n[0]].l = 3;
              moveList[n[0]].path[1] = (sq-10);
              m = (WHITE|MAN); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
              m = b[sq-5]; m = m << 8; m += (sq-5); moveList[n[0]].m[2] = m;
              if (sq <= 17) {
                m = (WHITE|KING); m = m << 8; m += (sq-10); moveList[n[0]].m[1] = m;
                tmp = b[sq-5]; b[sq-5] = OCCUPIED;
                whiteKingCapture(n, moveList, sq-10);
                b[sq-5] = tmp;
              } else {
                m = (WHITE|MAN); m = m << 8; m += (sq-10); moveList[n[0]].m[1] = m;
                tmp = b[sq-5]; b[sq-5] = OCCUPIED;
                whiteManCapture(n, moveList, sq-10);
                b[sq-5] = tmp;
              }
            }
          }
            
          b[sq] = (WHITE|MAN);
        }
        
        if ((b[sq] & KING) != 0) {
          b[sq] = FREE;
          
          // +4
          temp = sq;
          foundPd = 0;
          do temp += 4
          while((b[temp] & FREE) != 0);
          if ((b[temp] & BLACK) != 0) {
            capSq = temp;
            temp += 4;
            while((b[temp] & FREE) != 0) {
              if (testFrom13w(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp += 4;
            }
            if (!foundPd) {
              temp = capSq;
              temp += 4;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                blackKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp += 4;
              }
            }
          }
          
          // +5
          temp = sq;
          foundPd = 0;
          do temp += 5
          while((b[temp] & FREE) != 0);
          if ((b[temp] & BLACK) != 0) {
            capSq = temp;
            temp += 5;
            while((b[temp] & FREE) != 0) {
              if (testFrom02w(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp += 5;
            }
            if (!foundPd) {
              temp = capSq;
              temp += 5;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp += 5;
              }
            }
          }
          
          // -4
          temp = sq;
          foundPd = 0;
          do temp -= 4
          while((b[temp] & FREE) != 0);
          if ((b[temp] & BLACK) != 0) {
            capSq = temp;
            temp -= 4;
            while((b[temp] & FREE) != 0) {
              if (testFrom13w(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp -= 4;
            }
            if (!foundPd) {
              temp = capSq;
              temp -= 4;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp -= 4;
              }
            }
          }
          
          // -5
          temp = sq;
          foundPd = 0;
          do temp -= 5
          while((b[temp] & FREE) != 0);
          if ((b[temp] & BLACK) != 0) {
            capSq = temp;
            temp -= 5;
            while((b[temp] & FREE) != 0) {
              if (testFrom02w(temp)) {
                foundPd = 1;
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
              } temp -= 5;
            }
            if (!foundPd) {
              temp = capSq;
              temp -= 5;
              while((b[temp] & FREE) != 0) {
                moveList[n[0]].l = 3;
                moveList[n[0]].path[1] = temp;
                m = (WHITE|KING); m = m << 8; m += temp; moveList[n[0]].m[1] = m;
                m = (WHITE|KING); m = m << 8; m += sq; moveList[n[0]].m[0] = m;
                m = b[capSq]; m = m << 8; m += capSq; moveList[n[0]].m[2] = m;
                tmp = b[capSq]; b[capSq] = OCCUPIED;
                whiteKingCapture(n, moveList, temp);
                b[capSq] = tmp;
                temp -= 5;
              }
            }
          }
          
          b[sq] = (WHITE|KING);
        }
      }
    }
  } return n[0];
}

function testFrom13b(mloc) {
  let sq;
  sq = mloc;
  do sq += 5;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & WHITE) != 0)
    if ((b[sq+5] & FREE) != 0)
      return 1;
  sq = mloc;
  do sq -= 5;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & WHITE) != 0)
    if ((b[sq-5] & FREE) != 0)
      return 1;
  return 0;
}

function testFrom02b(mloc) {
  let sq;
  sq = mloc;
  do sq += 4;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & WHITE) != 0)
    if ((b[sq+4] & FREE) != 0)
      return 1;
  sq = mloc;
  do sq -= 4;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & WHITE) != 0)
    if ((b[sq-4] & FREE) != 0)
      return 1;
  return 0;
}

function testFrom13w(mloc) {
  let sq;
  sq = mloc;
  do sq += 5;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & BLACK) != 0)
    if ((b[sq+5] & FREE) != 0)
      return 1;
  sq = mloc;
  do sq -= 5;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & BLACK) != 0)
    if ((b[sq-5] & FREE) != 0)
      return 1;
  return 0;
}

function testFrom02w(mloc) {
  let sq;
  sq = mloc;
  do sq += 4;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & BLACK) != 0)
    if ((b[sq+4] & FREE) != 0)
      return 1;
  sq = mloc;
  do sq -= 4;
  while((b[sq] & FREE) != 0);
  if ((b[sq] & BLACK) != 0)
    if ((b[sq-4] & FREE) != 0)
      return 1;
  return 0;
}

function blackManCapture(n, moveList, j) {
  let m, temp, tmp;
  let foundCap = 0;
  let move, orgMove;
  orgMove = structuredClone(moveList[n[0]]); // fake *n pointer

  // +4
  if ((b[j+4] & WHITE) != 0) {
    if (b[j+8] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j+8);
      m = b[j+4]; m = m << 8; m += (j+4); move.m[move.l-1] = m;
      if (j >= 28) {
        m = (BLACK|KING); m = m << 8; m += (j+8); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j+4]; b[j+4] = OCCUPIED;
        blackKingCapture(n, moveList, j+8);
        b[j+4] = tmp;
      } else {
        m = (BLACK|MAN); m = m << 8; m += (j+8); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j+4]; b[j+4] = OCCUPIED;
        blackManCapture(n, moveList, j+8);
        b[j+4] = tmp;
      }
    }
  }
  
  // +5
  if ((b[j+5] & WHITE) != 0) {
    if (b[j+10] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j+10);
      m = b[j+5]; m = m << 8; m += (j+5); move.m[move.l-1] = m;
      if (j >= 28) {
        m = (BLACK|KING); m = m << 8; m += (j+10); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j+5]; b[j+5] = OCCUPIED;
        blackKingCapture(n, moveList, j+10);
        b[j+5] = tmp;
      } else {
        m = (BLACK|MAN); m = m << 8; m += (j+10); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j+5]; b[j+5] = OCCUPIED;
        blackManCapture(n, moveList, j+10);
        b[j+5] = tmp;
      }
    }
  }
  
  // -4
  if ((b[j-4] & WHITE) != 0) {
    if (b[j-8] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j-8);
      m = (BLACK|MAN); m = m << 8; m += (j-8); move.m[1] = m;
      m = b[j-4]; m = m << 8; m += (j-4); move.m[move.l-1] = m;
      foundCap = 1;
      moveList[n[0]] = structuredClone(move);
      tmp = b[j-4]; b[j-4] = OCCUPIED;
      blackManCapture(n, moveList, j-8);
      b[j-4] = tmp;
    }
  }
  
  // +5
  if ((b[j-5] & WHITE) != 0) {
    if (b[j-10] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j-10);
      m = (BLACK|MAN); m = m << 8; m += (j-10); move.m[1] = m;
      m = b[j-5]; m = m << 8; m += (j-5); move.m[move.l-1] = m;
      foundCap = 1;
      moveList[n[0]] = structuredClone(move);
      tmp = b[j-5]; b[j-5] = OCCUPIED;
      blackManCapture(n, moveList, j-10);
      b[j-5] = tmp;
    }
  } if (!foundCap) n[0]++;
}

function blackKingCapture(n, moveList, j) {
  let m, temp, tmp, capSq, foundPd;
  let foundCap = 0;
  let move, orgMove;
  orgMove = structuredClone(moveList[n[0]]); // fake *n pointer
  
  // +4
  temp = j;
  foundPd = 0;
  do temp += 4;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & WHITE) != 0) {
    capSq = temp;
    temp += 4;
    while ((b[temp] & FREE) != 0) {
      if (testFrom13b(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        blackKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp += 4;
      if (!foundPd) {
        temp = capSq;
        temp += 4;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          blackKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp += 4;
        }
      }
    }
  }
  
  // +5
  temp = j;
  foundPd = 0;
  do temp += 5;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & WHITE) != 0) {
    capSq = temp;
    temp += 5;
    while ((b[temp] & FREE) != 0) {
      if (testFrom02b(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        blackKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp += 5;
      if (!foundPd) {
        temp = capSq;
        temp += 5;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          blackKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp += 5;
        }
      }
    }
  }
  
  // -4
  temp = j;
  foundPd = 0;
  do temp -= 4;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & WHITE) != 0) {
    capSq = temp;
    temp -= 4;
    while ((b[temp] & FREE) != 0) {
      if (testFrom13b(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        blackKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp -= 4;
      if (!foundPd) {
        temp = capSq;
        temp -= 4;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          blackKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp -= 4;
        }
      }
    }
  }
  
  // -5
  temp = j;
  foundPd = 0;
  do temp -= 5;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & WHITE) != 0) {
    capSq = temp;
    temp -= 5;
    while ((b[temp] & FREE) != 0) {
      if (testFrom02b(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        blackKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp -= 5;
      if (!foundPd) {
        temp = capSq;
        temp -= 5;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (BLACK|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          blackKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp -= 5;
        }
      }
    }
  } if (!foundCap) n[0]++;
}


function whiteManCapture(n, moveList, j) {
  let m, temp, tmp;
  let foundCap = 0;
  let move, orgMove;
  orgMove = structuredClone(moveList[n[0]]); // fake *n pointer

  // +4
  if ((b[j+4] & BLACK) != 0) {
    if (b[j+8] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j+8);
      m = (WHITE|MAN); m = m << 8; m += (j+8); move.m[1] = m;
      m = b[j+4]; m = m << 8; m += (j+4); move.m[move.l-1] = m;
      foundCap = 1;
      moveList[n[0]] = structuredClone(move);
      tmp = b[j+4]; b[j+4] = OCCUPIED;
      whiteManCapture(n, moveList, j+8);
      b[j+4] = tmp;
    }
  }
  
  // +5
  if ((b[j+5] & BLACK) != 0) {
    if (b[j+10] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j+10);
      m = (WHITE|MAN); m = m << 8; m += (j+10); move.m[1] = m;
      m = b[j+5]; m = m << 8; m += (j+5); move.m[move.l-1] = m;
      foundCap = 1;
      moveList[n[0]] = structuredClone(move);
      tmp = b[j+5]; b[j+5] = OCCUPIED;
      whiteManCapture(n, moveList, j+10);
      b[j+5] = tmp;
    }
  }
  
  // -4
  if ((b[j-4] & BLACK) != 0) {
    if (b[j-8] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j-8);
      m = b[j-4]; m = m << 8; m += (j-4); move.m[move.l-1] = m;
      if (j <= 17) {
        m = (WHITE|KING); m = m << 8; m += (j-8); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j-4]; b[j-4] = OCCUPIED;
        whiteKingCapture(n, moveList, j-8);
        b[j-4] = tmp;
      } else {
        m = (WHITE|MAN); m = m << 8; m += (j-8); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j-4]; b[j-4] = OCCUPIED;
        whiteManCapture(n, moveList, j-8);
        b[j-4] = tmp;
      }
    }
  }
  
  // -5
  if ((b[j-5] & BLACK) != 0) {
    if (b[j-10] & FREE ) {
      move = structuredClone(orgMove);
      move.l++;
      move.path[move.l-2] = (j-10);
      m = b[j-5]; m = m << 8; m += (j-5); move.m[move.l-1] = m;
      if (j <= 17) {
        m = (WHITE|KING); m = m << 8; m += (j-10); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j-5]; b[j-5] = OCCUPIED;
        whiteKingCapture(n, moveList, j-10);
        b[j-5] = tmp;
      } else {
        m = (WHITE|MAN); m = m << 8; m += (j-10); move.m[1] = m;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[j-5]; b[j-5] = OCCUPIED;
        whiteManCapture(n, moveList, j-10);
        b[j-5] = tmp;
      }
    }
  } if (!foundCap) n[0]++;
}

function whiteKingCapture(n, moveList, j) {
  let m, temp, tmp, capSq, foundPd;
  let foundCap = 0;
  let move, orgMove;
  orgMove = structuredClone(moveList[n[0]]); // fake *n pointer
  
  // +4
  temp = j;
  foundPd = 0;
  do temp += 4;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & BLACK) != 0) {
    capSq = temp;
    temp += 4;
    while ((b[temp] & FREE) != 0) {
      if (testFrom13w(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        whiteKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp += 4;
      if (!foundPd) {
        temp = capSq;
        temp += 4;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          whiteKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp += 4;
        }
      }
    }
  }
  
  // +5
  temp = j;
  foundPd = 0;
  do temp += 5;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & BLACK) != 0) {
    capSq = temp;
    temp += 5;
    while ((b[temp] & FREE) != 0) {
      if (testFrom02w(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        whiteKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp += 5;
      if (!foundPd) {
        temp = capSq;
        temp += 5;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          whiteKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp += 5;
        }
      }
    }
  }
  
  // -4
  temp = j;
  foundPd = 0;
  do temp -= 4;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & BLACK) != 0) {
    capSq = temp;
    temp -= 4;
    while ((b[temp] & FREE) != 0) {
      if (testFrom13w(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        whiteKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp -= 4;
      if (!foundPd) {
        temp = capSq;
        temp -= 4;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          whiteKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp -= 4;
        }
      }
    }
  }
  
  // -5
  temp = j;
  foundPd = 0;
  do temp -= 5;
  while((b[temp] & FREE) != 0);
  if ((b[temp] & BLACK) != 0) {
    capSq = temp;
    temp -= 5;
    while ((b[temp] & FREE) != 0) {
      if (testFrom02w(temp)) {
        move = structuredClone(orgMove);
        move.l++;
        move.path[move.l-2] = temp;
        m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
        m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
        foundPd = 1;
        foundCap = 1;
        moveList[n[0]] = structuredClone(move);
        tmp = b[capSq]; b[capSq] = OCCUPIED;
        whiteKingCapture(n, moveList, temp);
        b[capSq] = tmp;
      } temp -= 5;
      if (!foundPd) {
        temp = capSq;
        temp -= 5;
        while((b[temp] & FREE) != 0) {
          move = structuredClone(orgMove);
          move.l++;
          move.path[move.l-2] = temp;
          m = (WHITE|KING); m = m << 8; m += temp; move.m[1] = m;
          m = b[capSq]; m = m << 8; m += capSq; move.m[move.l-1] = m;
          foundCap = 1;
          moveList[n[0]] = structuredClone(move);
          tmp = b[capSq]; b[capSq] = OCCUPIED;
          whiteKingCapture(n, moveList, temp);
          b[capSq] = tmp;
          temp -= 5;
        }
      }
    }
  } if (!foundCap) n[0]++;
}

function makeMove(move) {
  let sq, after;
  sq = move.m[0] & 255;
  b[sq] = FREE;
  sq = move.m[1] & 255;
  after = (move.m[1] >> 8);
  b[sq]=after;
  for (let i = 2; i < move.l; i++) {
    sq = (move.m[i] & 255);
    b[sq] = FREE;
  } ply++;
}

function undoMove(move) {
  let sq, before;
  sq = move.m[1] & 255;
  b[sq] = FREE;
  sq = move.m[0] & 255;
  before = (move.m[0] >> 8);
  b[sq] = before;
  for (let i = 2; i < move.l; i++) {
    sq = (move.m[i] & 255);
    before = (move.m[i] >> 8);
    b[sq] = before;
  } ply--;
}

dsp2brd();
printBoard();

//let moveList = createMoveList();
//let n = generateQuiets(moveList, WHITE);
//printMoveList(moveList, n);

let moveList = createMoveList();
//blackKingCapture(n, moveList, coord2sq['a7']);
let n = generateCaptures(moveList, WHITE);
printMoveList(moveList, n);
console.log(moveList);

</script>













